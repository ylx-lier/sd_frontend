# Clash 代理设置指南

## 🌐 Clash 代理配置步骤

### 1. 确认 Clash 运行状态
1. 打开 Clash for Windows
2. 确保 Clash 正在运行（系统托盘有图标）
3. 确保已导入有效的代理配置文件

### 2. 查看 Clash 端口设置
1. 打开 Clash for Windows 主界面
2. 点击左侧 "General" 或"常规"选项卡
3. 查看以下端口信息：
   - **HTTP Port（HTTP端口）**: 通常是 `7890`
   - **SOCKS Port（SOCKS端口）**: 通常是 `7891`
   - **Mixed Port（混合端口）**: 如果启用，通常是 `7892`

### 3. 常见的 Clash 代理地址
根据您的 Clash 设置，代理地址通常是：

#### 标准配置：
- **HTTP代理**: `http://127.0.0.1:7890`
- **HTTPS代理**: `http://127.0.0.1:7890`

#### 如果使用不同端口：
- **HTTP代理**: `http://127.0.0.1:[您的HTTP端口]`
- **HTTPS代理**: `http://127.0.0.1:[您的HTTP端口]`

### 4. 在 AI 图像生成器中配置代理

1. 启动 AI 图像生成器应用
2. 展开 "🌐 网络代理设置" 面板
3. 勾选 "启用代理"
4. 填写代理地址：
   - **HTTP 代理**: `http://127.0.0.1:7890`
   - **HTTPS 代理**: `http://127.0.0.1:7890`
5. 点击 "🔗 测试代理连接" 按钮验证
6. 如果测试成功，即可正常使用 API 模式

### 5. 故障排除

#### 如果代理测试失败：

1. **检查 Clash 状态**：
   - 确保 Clash 正在运行
   - 确保代理服务器连接正常
   - 在 Clash 中测试代理是否可以访问外网

2. **检查端口号**：
   - 打开 Clash，确认实际使用的端口号
   - 如果端口不是 7890，请修改代理地址

3. **检查代理模式**：
   - 在 Clash 中确保选择了正确的代理模式（Rule、Global 等）
   - 确保 Hugging Face 的域名没有被直连规则排除

4. **防火墙检查**：
   - 确保 Windows 防火墙允许 Python 和 Clash 的网络访问
   - 暂时关闭防火墙测试（不推荐长期关闭）

#### 常见错误解决：

- **"Connection refused"**: Clash 未运行或端口错误
- **"Timeout"**: 代理服务器连接问题，检查 Clash 配置
- **"Proxy connection failed"**: 代理地址格式错误，确保包含 `http://`

### 6. 其他代理软件配置

#### V2Ray / V2RayN：
- 通常端口：`10808` (HTTP) / `10809` (SOCKS)
- 代理地址：`http://127.0.0.1:10808`

#### Shadowsocks：
- 通常端口：`1080` (SOCKS) / `1087` (HTTP)
- 代理地址：`http://127.0.0.1:1087`

#### Surge：
- 通常端口：`6152` (HTTP) / `6153` (SOCKS)
- 代理地址：`http://127.0.0.1:6152`

### 7. 验证代理是否工作

配置完成后，您可以：

1. 点击应用中的 "🔗 测试代理连接" 按钮
2. 尝试生成图像，看是否还有超时错误
3. 如果仍有问题，检查 Clash 日志查看连接详情

### 8. 性能优化建议

1. **选择合适的代理节点**：选择延迟低、速度快的节点
2. **调整超时设置**：应用已将超时时间增加到120秒
3. **监控流量使用**：注意代理服务的流量限制

---

## 📝 快速配置总结

1. ✅ 启动 Clash for Windows
2. ✅ 确认 HTTP 端口（通常是 7890）
3. ✅ 在应用中启用代理
4. ✅ 填写：`http://127.0.0.1:7890`
5. ✅ 测试连接
6. ✅ 开始使用 API 模式生成图像

如果您按照以上步骤操作后仍有问题，请检查具体的错误信息，我们可以进一步排查。
